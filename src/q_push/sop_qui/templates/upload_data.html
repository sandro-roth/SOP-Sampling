  <style>
    body.container {
      max-width: 900px;
      margin: 2rem auto;
    }

    .box-header {
      border: 1px solid #ccc;
      padding: 0.8rem 1rem;
      border-radius: 4px;
      margin-bottom: 1rem;
      background: var(--pico-background-color);
    }

    .box-title {
      font-weight: 600;
      margin: 0 0 0.6rem 0;
    }

    .error-list {
      border: 1px solid #c00;
      background: #fdd;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      margin-bottom: 1rem;
    }

    .success-box {
      border: 1px solid #0a0;
      background: #e7ffe7;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      margin-bottom: 1rem;
    }

    .preview-box {
      border: 1px solid #ccc;
      padding: 0.8rem 1rem;
      border-radius: 4px;
      background: var(--pico-muted-border-color);
      margin-top: 1rem;
      white-space: pre;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 1rem;
      align-items: center;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .full-width small {
      display: block;
      margin-top: 0.3rem;
    }
  </style>

<h1>Data upload and preview</h1>

  <!-- Error messages -->
  {% if errors %}
    <div class="error-list">
      <ul>
        {% for e in errors %}
          <li>{{ e }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if success_message %}
    <div class="success-box">
      {{ success_message }}
    </div>
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    <div class="box-header">
      <div class="box-title">Input options</div>

      <p>
        You can either upload a CSV or text file, or enter questions manually.
        Files take priority if both are provided.
      </p>

      <div class="form-grid">
        <!-- File input -->
        <div>
          <label for="data_file">CSV or text file</label>
        </div>
        <div>
          <input
            type="file"
            id="data_file"
            name="data_file"
            accept=".csv,.txt"
          >
          <small>Allowed extensions: .csv and .txt</small>
        </div>

        <!-- Manual text -->
        <div class="full-width">
          <label for="manual_text">Manual input (comma separated columns per line)</label>
          <textarea
            id="manual_text"
            name="manual_text"
            rows="6"
            style="width: 100%;"
            placeholder="Question 1, Answer 1, Passage 1&#10;Question 2, Answer 2, Passage 2"
          >{{ manual_text }}</textarea><br>
          <small>
            Each non empty line becomes one row, commas separate columns.
            If a field contains commas, wrap it in double quotes.
            For example: <code>This is a question?, This is the answer!, 'This, passage'</code> becomes <code>('This is a question?', 'This is the answer!', 'This, passage')</code>.
          </small>
        </div>
      </div>
    </div>

    <button type="submit" name="action" value="preview">
      Preview (max 5 rows)
    </button>
    <button type="submit" name="action" value="submit">
      Submit to database
    </button>
    <button type="submit" name="action" value="clear">
      Clear form and preview
    </button>
  </form>

  <!-- Preview section -->
  {% if preview_text %}
    <h2 style="margin-top: 2rem;">Preview of stored data (max 5 rows)</h2>

    {% if file_name %}
      <p>File used: <strong>{{ file_name }}</strong></p>
    {% endif %}

    <div class="preview-box">
      {{ preview_text }}
    </div>
  {% endif %}
